"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseListBox = void 0;
const parse_box_1 = require("./parse-box");
const parseListBox = async ({ iterator, size, state, }) => {
    const counter = iterator.counter.getOffset();
    const listType = iterator.getByteString(4, false);
    if (listType === 'movi') {
        throw new Error('should not be handled here');
    }
    const structure = {
        type: 'riff',
        boxes: [],
    };
    const result = await (0, parse_box_1.parseRiffBody)({
        structure,
        iterator,
        maxOffset: counter + size,
        state,
    });
    if (result.status === 'incomplete') {
        throw new Error(`Should only parse complete boxes (${listType})`);
    }
    return {
        type: 'list-box',
        listType,
        children: structure.boxes,
    };
};
exports.parseListBox = parseListBox;
