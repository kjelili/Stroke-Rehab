"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.emitAvailableInfo = void 0;
const get_audio_codec_1 = require("./get-audio-codec");
const get_container_1 = require("./get-container");
const get_dimensions_1 = require("./get-dimensions");
const get_duration_1 = require("./get-duration");
const get_fps_1 = require("./get-fps");
const get_is_hdr_1 = require("./get-is-hdr");
const get_keyframes_1 = require("./get-keyframes");
const get_location_1 = require("./get-location");
const get_tracks_1 = require("./get-tracks");
const get_video_codec_1 = require("./get-video-codec");
const get_metadata_1 = require("./metadata/get-metadata");
const emitAvailableInfo = ({ hasInfo, parseResult, callbacks, state, returnValue, contentLength, name, mimeType, fieldsInReturnValue, }) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y;
    const keys = Object.keys(hasInfo);
    const segments = state.structure.getStructureOrNull();
    const { emittedFields } = state;
    for (const key of keys) {
        if (key === 'structure') {
            if (parseResult &&
                hasInfo.structure &&
                !emittedFields.structure &&
                segments) {
                (_a = callbacks.onStructure) === null || _a === void 0 ? void 0 : _a.call(callbacks, segments);
                if (fieldsInReturnValue.structure) {
                    returnValue.structure = segments;
                }
                emittedFields.structure = true;
            }
            continue;
        }
        if (key === 'durationInSeconds') {
            if (hasInfo.durationInSeconds && parseResult && segments) {
                if (!emittedFields.durationInSeconds) {
                    const durationInSeconds = (0, get_duration_1.getDuration)(segments, state);
                    (_b = callbacks.onDurationInSeconds) === null || _b === void 0 ? void 0 : _b.call(callbacks, durationInSeconds);
                    if (fieldsInReturnValue.durationInSeconds) {
                        returnValue.durationInSeconds = durationInSeconds;
                    }
                    emittedFields.durationInSeconds = true;
                }
            }
            continue;
        }
        if (key === 'slowDurationInSeconds') {
            if (hasInfo.slowDurationInSeconds &&
                !emittedFields.slowDurationInSeconds &&
                parseResult &&
                segments) {
                const slowDurationInSeconds = (_c = (0, get_duration_1.getDuration)(segments, state)) !== null && _c !== void 0 ? _c : state.slowDurationAndFps.getSlowDurationInSeconds();
                (_d = callbacks.onSlowDurationInSeconds) === null || _d === void 0 ? void 0 : _d.call(callbacks, slowDurationInSeconds);
                if (fieldsInReturnValue.slowDurationInSeconds) {
                    returnValue.slowDurationInSeconds = slowDurationInSeconds;
                }
                emittedFields.slowDurationInSeconds = true;
            }
            continue;
        }
        if (key === 'fps') {
            if (hasInfo.fps && parseResult && segments) {
                if (!emittedFields.fps) {
                    const fps = (0, get_fps_1.getFps)(segments);
                    (_e = callbacks.onFps) === null || _e === void 0 ? void 0 : _e.call(callbacks, fps);
                    if (fieldsInReturnValue.fps) {
                        returnValue.fps = fps;
                    }
                    emittedFields.fps = true;
                }
                if (!emittedFields.slowFps) {
                    const fps = (0, get_fps_1.getFps)(segments);
                    if (fps) {
                        (_f = callbacks.onSlowFps) === null || _f === void 0 ? void 0 : _f.call(callbacks, fps);
                        if (fieldsInReturnValue.slowFps) {
                            returnValue.slowFps = fps;
                        }
                        emittedFields.slowFps = true;
                    }
                }
            }
            continue;
        }
        // must be handled after fps
        if (key === 'slowFps') {
            if (hasInfo.slowFps &&
                !emittedFields.slowFps &&
                parseResult &&
                segments) {
                const slowFps = state.slowDurationAndFps.getFps();
                (_g = callbacks.onSlowFps) === null || _g === void 0 ? void 0 : _g.call(callbacks, slowFps);
                if (fieldsInReturnValue.slowFps) {
                    returnValue.slowFps = slowFps;
                }
                emittedFields.slowFps = true;
            }
            continue;
        }
        if (key === 'dimensions') {
            if (hasInfo.dimensions &&
                !emittedFields.dimensions &&
                parseResult &&
                segments) {
                const dimensionsQueried = (0, get_dimensions_1.getDimensions)(segments, state);
                const dimensions = {
                    height: dimensionsQueried.height,
                    width: dimensionsQueried.width,
                };
                (_h = callbacks.onDimensions) === null || _h === void 0 ? void 0 : _h.call(callbacks, dimensions);
                if (fieldsInReturnValue.dimensions) {
                    returnValue.dimensions = dimensions;
                }
                emittedFields.dimensions = true;
            }
            continue;
        }
        if (key === 'unrotatedDimensions') {
            if (hasInfo.unrotatedDimensions &&
                !emittedFields.unrotatedDimensions &&
                parseResult &&
                segments) {
                const dimensionsQueried = (0, get_dimensions_1.getDimensions)(segments, state);
                const unrotatedDimensions = {
                    height: dimensionsQueried.unrotatedHeight,
                    width: dimensionsQueried.unrotatedWidth,
                };
                (_j = callbacks.onUnrotatedDimensions) === null || _j === void 0 ? void 0 : _j.call(callbacks, unrotatedDimensions);
                if (fieldsInReturnValue.unrotatedDimensions) {
                    returnValue.unrotatedDimensions = unrotatedDimensions;
                }
                emittedFields.unrotatedDimensions = true;
            }
            continue;
        }
        if (key === 'rotation') {
            if (hasInfo.rotation &&
                !emittedFields.rotation &&
                parseResult &&
                segments) {
                const dimensionsQueried = (0, get_dimensions_1.getDimensions)(segments, state);
                const { rotation } = dimensionsQueried;
                (_k = callbacks.onRotation) === null || _k === void 0 ? void 0 : _k.call(callbacks, rotation);
                if (fieldsInReturnValue.rotation) {
                    returnValue.rotation = rotation;
                }
                emittedFields.rotation = true;
            }
            continue;
        }
        if (key === 'videoCodec') {
            if (!emittedFields.videoCodec &&
                hasInfo.videoCodec &&
                parseResult &&
                segments) {
                const videoCodec = (0, get_video_codec_1.getVideoCodec)(segments, state);
                (_l = callbacks.onVideoCodec) === null || _l === void 0 ? void 0 : _l.call(callbacks, videoCodec);
                if (fieldsInReturnValue.videoCodec) {
                    returnValue.videoCodec = videoCodec;
                }
                emittedFields.videoCodec = true;
            }
            continue;
        }
        if (key === 'audioCodec') {
            if (!emittedFields.audioCodec &&
                hasInfo.audioCodec &&
                parseResult &&
                segments) {
                const audioCodec = (0, get_audio_codec_1.getAudioCodec)(segments, state);
                (_m = callbacks.onAudioCodec) === null || _m === void 0 ? void 0 : _m.call(callbacks, audioCodec);
                if (fieldsInReturnValue.audioCodec) {
                    returnValue.audioCodec = audioCodec;
                }
                emittedFields.audioCodec = true;
            }
            continue;
        }
        if (key === 'tracks') {
            if (!emittedFields.tracks && hasInfo.tracks && parseResult && segments) {
                const { videoTracks, audioTracks } = (0, get_tracks_1.getTracks)(segments, state);
                (_o = callbacks.onTracks) === null || _o === void 0 ? void 0 : _o.call(callbacks, { videoTracks, audioTracks });
                if (fieldsInReturnValue.tracks) {
                    returnValue.tracks = { videoTracks, audioTracks };
                }
                emittedFields.tracks = true;
            }
            continue;
        }
        if (key === 'internalStats') {
            // Special case: Always emitting internal stats at the end
            if (hasInfo.internalStats) {
                const internalStats = state.getInternalStats();
                if (fieldsInReturnValue.internalStats) {
                    returnValue.internalStats = internalStats;
                }
                emittedFields.internalStats = true;
            }
            continue;
        }
        if (key === 'size') {
            if (!emittedFields.size && hasInfo.size) {
                (_p = callbacks.onSize) === null || _p === void 0 ? void 0 : _p.call(callbacks, contentLength);
                if (fieldsInReturnValue.size) {
                    returnValue.size = contentLength;
                }
                emittedFields.size = true;
            }
            continue;
        }
        if (key === 'mimeType') {
            if (!emittedFields.mimeType && hasInfo.mimeType) {
                (_q = callbacks.onMimeType) === null || _q === void 0 ? void 0 : _q.call(callbacks, mimeType);
                if (fieldsInReturnValue.mimeType) {
                    returnValue.mimeType = mimeType;
                }
                emittedFields.mimeType = true;
            }
            continue;
        }
        if (key === 'name') {
            if (!emittedFields.name && hasInfo.name) {
                (_r = callbacks.onName) === null || _r === void 0 ? void 0 : _r.call(callbacks, name);
                if (fieldsInReturnValue.name) {
                    returnValue.name = name;
                }
                emittedFields.name = true;
            }
            continue;
        }
        if (key === 'isHdr') {
            if (!returnValue.isHdr && hasInfo.isHdr && parseResult && segments) {
                const isHdr = (0, get_is_hdr_1.getIsHdr)(segments, state);
                (_s = callbacks.onIsHdr) === null || _s === void 0 ? void 0 : _s.call(callbacks, isHdr);
                if (fieldsInReturnValue.isHdr) {
                    returnValue.isHdr = isHdr;
                }
                emittedFields.isHdr = true;
            }
            continue;
        }
        if (key === 'container') {
            if (!returnValue.container &&
                hasInfo.container &&
                parseResult &&
                segments) {
                const container = (0, get_container_1.getContainer)(segments);
                (_t = callbacks.onContainer) === null || _t === void 0 ? void 0 : _t.call(callbacks, container);
                if (fieldsInReturnValue.container) {
                    returnValue.container = container;
                }
                emittedFields.container = true;
            }
            continue;
        }
        if (key === 'metadata') {
            if (!emittedFields.metadata &&
                hasInfo.metadata &&
                parseResult &&
                segments) {
                const metadata = (0, get_metadata_1.getMetadata)(segments);
                (_u = callbacks.onMetadata) === null || _u === void 0 ? void 0 : _u.call(callbacks, metadata);
                if (fieldsInReturnValue.metadata) {
                    returnValue.metadata = metadata;
                }
                emittedFields.metadata = true;
            }
            continue;
        }
        if (key === 'location') {
            if (!emittedFields.location &&
                hasInfo.location &&
                parseResult &&
                segments) {
                const location = (0, get_location_1.getLocation)(segments);
                (_v = callbacks.onLocation) === null || _v === void 0 ? void 0 : _v.call(callbacks, location);
                if (fieldsInReturnValue.location) {
                    returnValue.location = location;
                }
                emittedFields.location = true;
            }
            continue;
        }
        if (key === 'slowKeyframes') {
            if (!emittedFields.slowKeyframes &&
                hasInfo.slowKeyframes &&
                parseResult) {
                (_w = callbacks.onSlowKeyframes) === null || _w === void 0 ? void 0 : _w.call(callbacks, state.keyframes.getKeyframes());
                if (fieldsInReturnValue.slowKeyframes) {
                    returnValue.slowKeyframes = state.keyframes.getKeyframes();
                }
                emittedFields.slowKeyframes = true;
            }
            continue;
        }
        if (key === 'slowNumberOfFrames') {
            if (!emittedFields.slowNumberOfFrames &&
                hasInfo.slowNumberOfFrames &&
                parseResult) {
                (_x = callbacks.onSlowNumberOfFrames) === null || _x === void 0 ? void 0 : _x.call(callbacks, state.slowDurationAndFps.getSlowNumberOfFrames());
                if (fieldsInReturnValue.slowNumberOfFrames) {
                    returnValue.slowNumberOfFrames =
                        state.slowDurationAndFps.getSlowNumberOfFrames();
                }
                emittedFields.slowNumberOfFrames = true;
            }
            continue;
        }
        if (key === 'keyframes') {
            if (!emittedFields.keyframes && hasInfo.keyframes && parseResult) {
                (_y = callbacks.onKeyframes) === null || _y === void 0 ? void 0 : _y.call(callbacks, (0, get_keyframes_1.getKeyframes)(state.structure.getStructure()));
                if (fieldsInReturnValue.keyframes) {
                    returnValue.keyframes = (0, get_keyframes_1.getKeyframes)(state.structure.getStructure());
                }
                emittedFields.keyframes = true;
            }
            continue;
        }
        throw new Error(`Unhandled key: ${key}`);
    }
};
exports.emitAvailableInfo = emitAvailableInfo;
