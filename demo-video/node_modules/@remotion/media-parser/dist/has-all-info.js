"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasAllInfo = exports.getAvailableInfo = void 0;
const get_audio_codec_1 = require("./get-audio-codec");
const get_container_1 = require("./get-container");
const get_dimensions_1 = require("./get-dimensions");
const get_duration_1 = require("./get-duration");
const get_fps_1 = require("./get-fps");
const get_is_hdr_1 = require("./get-is-hdr");
const get_keyframes_1 = require("./get-keyframes");
const get_tracks_1 = require("./get-tracks");
const get_video_codec_1 = require("./get-video-codec");
const may_skip_video_data_1 = require("./may-skip-video-data/may-skip-video-data");
const getAvailableInfo = ({ fieldsToFetch, state, }) => {
    const keys = Object.entries(fieldsToFetch).filter(([, value]) => value);
    const structure = state.structure.getStructureOrNull();
    const infos = keys.map(([_key]) => {
        const key = _key;
        if (key === 'structure') {
            return false;
        }
        if (key === 'durationInSeconds') {
            return Boolean(structure && (0, get_duration_1.hasDuration)(structure, state));
        }
        if (key === 'slowDurationInSeconds') {
            return Boolean(structure && (0, get_duration_1.hasSlowDuration)(structure, state));
        }
        if (key === 'dimensions' ||
            key === 'rotation' ||
            key === 'unrotatedDimensions') {
            return Boolean(structure && (0, get_dimensions_1.hasDimensions)(structure, state));
        }
        if (key === 'fps') {
            return Boolean(structure && (0, get_fps_1.hasFps)(structure));
        }
        if (key === 'slowFps') {
            // In case FPS is available an non-null, it also works for `slowFps`
            return Boolean(structure && (0, get_fps_1.hasFpsSuitedForSlowFps)(structure));
        }
        if (key === 'isHdr') {
            return Boolean(structure && (0, get_is_hdr_1.hasHdr)(structure, state));
        }
        if (key === 'videoCodec') {
            return Boolean(structure && (0, get_video_codec_1.hasVideoCodec)(structure, state));
        }
        if (key === 'audioCodec') {
            return Boolean(structure && (0, get_audio_codec_1.hasAudioCodec)(structure, state));
        }
        if (key === 'tracks') {
            return Boolean(structure && (0, get_tracks_1.hasTracks)(structure, state));
        }
        if (key === 'keyframes') {
            return Boolean(structure && (0, get_keyframes_1.hasKeyframes)(structure, state));
        }
        if (key === 'internalStats') {
            return true;
        }
        if (key === 'size') {
            return true;
        }
        if (key === 'mimeType') {
            return true;
        }
        if (key === 'name') {
            return true;
        }
        if (key === 'container') {
            return Boolean(structure && (0, get_container_1.hasContainer)(structure));
        }
        if (key === 'metadata' || key === 'location') {
            return false;
        }
        if (key === 'slowKeyframes') {
            return false;
        }
        if (key === 'slowNumberOfFrames') {
            return false;
        }
        throw new Error(`Unknown key: ${key}`);
    });
    const entries = [];
    let i = 0;
    for (const [key] of keys) {
        entries.push([key, infos[i++]]);
    }
    return Object.fromEntries(entries);
};
exports.getAvailableInfo = getAvailableInfo;
const hasAllInfo = ({ fields, state, }) => {
    const availableInfo = (0, exports.getAvailableInfo)({
        fieldsToFetch: fields !== null && fields !== void 0 ? fields : {},
        state,
    });
    return (Object.values(availableInfo).every(Boolean) &&
        ((0, may_skip_video_data_1.maySkipVideoData)({ state }) ||
            state.callbacks.canSkipTracksState.canSkipTracks()));
};
exports.hasAllInfo = hasAllInfo;
